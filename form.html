<html>
<head>
    <title>Document</title>
</head>
<body>
    <header>
        <h1>Expense App</h1>
      </header>
      <form onsubmit="saveToSql(event)">
        <label>Choose Expense Amount</label>
        <input id="amount" type="number" name="amount" required>
        <label>Choose description</label>
        <input id="description" type="text" name="description" required>
        <label>Choose a category</label>
        <select id="category" name="category" required>
            <option>Movie</option>
            <option>Electricity</option>
            <option>Fuel</option>
            <option>Food</option>
            <option>Tour</option>
        </select>
        <br><br>
        <button>Add Expense</button>
    </form>
    <ul id='listOfUsers'></ul>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.1.3/axios.min.js"> </script>
    <script>
        function saveToSql(event) 
        {
            event.preventDefault();
            const amount = event.target.amount.value;
            const description = event.target.description.value;
            const category = event.target.category.value;
           
            const obj = {
                amount,
                description,
                category
            };
            
            axios.post("http://localhost:3000/expense/add-expense", obj)
            .then((response)=>{
                console.log(response)
                showExpense(response.data.newExpenseDetail)
            })
            .catch((err)=>{
                document.body.innerHTML = document.body.innerHTML + "<h4>Something went wrong </h4>"
                console.log(err)
            })
        }  
        
        window.addEventListener("DOMContentLoaded", () => 
        {
            axios.get("http://localhost:3000/expense/get-expense")
            .then((response)=>{
                console.log(response);
                for(var i=0; i<response.data.allExpenses.length; i++)
                {
                    showExpense(response.data.allExpenses[i])
                }
            })
            .catch((err)=>{
                console.log(err)
            })
        })

        function showExpense(expense)
        {
            document.getElementById('amount').value = '';
            document.getElementById('description').value = '';
            document.getElementById('category').value ='';
           
            const parentNode = document.getElementById('listOfUsers');
            const childHTML = `<li id=${expense.id}> ${expense.amount} - ${expense.description} - ${expense.category}
                                    <button onclick=deleteExpense('${expense.id}')> Delete Expense </button>
                                    <button onclick=editExpense('${expense.amount}','${expense.description}','${expense.category}','${expense.id}')>Edit Expense</button>
                                </li>`

            parentNode.innerHTML = parentNode.innerHTML + childHTML;
        }

        function editExpense(amount, description, category, expenseId)
        {
            document.getElementById('amount').value = amount;
            document.getElementById('description').value = description;
            document.getElementById('category').value = category;

            deleteExpense(expenseId)
        }


        function deleteExpense(expenseId)
        {
            axios.delete(`http://localhost:3000/expense/delete-expense/${expenseId}`)
            .then((response)=>{
                removeUserFromScreen(expenseId)
            })
            .catch((err)=>{
                console.log(err)
            })
        }

        function removeUserFromScreen(expenseId)
        {
            const parentNode = document.getElementById('listOfUsers');
            const childNodeToBeDeleted = document.getElementById(expenseId);
            if(childNodeToBeDeleted) 
            {
                parentNode.removeChild(childNodeToBeDeleted)
            }
        }

    </script>
</body>
</html>